var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){a!=Array.prototype&&a!=Object.prototype&&(a[c]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,d,b){if(c){d=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var e=a[b];e in d||(d[e]={});d=d[e]}a=a[a.length-1];b=d[a];c=c(b);c!=b&&null!=c&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:c})}};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},c={};try{return c.__proto__=a,c.a}catch(d){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,c){a.__proto__=c;if(a.__proto__!==c)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.polyfill("Object.setPrototypeOf",function(a){return a||$jscomp.setPrototypeOf},"es6","es5");
var __extends=this&&this.__extends||function(){var a=function(c,d){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,e){b.__proto__=e}||function(b,e){for(var a in e)e.hasOwnProperty(a)&&(b[a]=e[a])};return a(c,d)};return function(c,d){function b(){this.constructor=c}a(c,d);c.prototype=null===d?Object.create(d):(b.prototype=d.prototype,new b)}}(),pages;
(function(a){var c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}__extends(b,a);Object.defineProperty(b.prototype,"appName",{get:function(){return"index"},enumerable:!0,configurable:!0});b.prototype.init=function(){$ts("#enter").onclick=function(){$goto("/login")}};return b}(Bootstrap);a.index=c})(pages||(pages={}));
(function(a){var c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}__extends(b,a);Object.defineProperty(b.prototype,"appName",{get:function(){return"login"},enumerable:!0,configurable:!0});b.prototype.init=function(){var a=this;$ts.select(".people-link").onClick(function(b){return a.doLogin(b.getAttribute("people"))})};b.prototype.doLogin=function(a){var b=this;clearInterval();$ts("#open-msg").click();$ts.post("@api:login",{people:a},function(a){0==a.code?setInterval(function(){b.doCheckLogin()},
1E3):console.error(a.info)})};b.prototype.doCheckLogin=function(){$ts.get("@api:check",function(a){0==a.code?"1"==a.info&&$goto("/home"):console.error(a.info)})};return b}(Bootstrap);a.login=c})(pages||(pages={}));
(function(a){var c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}__extends(b,a);Object.defineProperty(b.prototype,"appName",{get:function(){return"home"},enumerable:!0,configurable:!0});b.prototype.init=function(){$ts.select(".type0").ForEach(function(a){return a.style.display="none"});$ts("#share_geo").onclick=function(){webapp.modules.getLocation()};$ts("#granted").onclick=function(){"granted"!=Notification.permission&&Notification.requestPermission().then(function(a){"granted"==
a?webapp.modules.startNotification():webapp.displayMsg("???????")})};$("#open-msg").click()};return b}(Bootstrap);a.home=c})(pages||(pages={}));
(function(a){var c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}__extends(b,a);Object.defineProperty(b.prototype,"appName",{get:function(){return"chat"},enumerable:!0,configurable:!0});b.prototype.init=function(){var a=this;setInterval(function(){a.fetchMessage()},1E3);$ts("#send").onclick=function(){a.sendComment()};$ts("#share_geo").onclick=function(){webapp.modules.getLocation()}};b.prototype.sendComment=function(){var a=$ts.value("#comment"),b={resource:-1,comment:a};
if(Strings.Empty(a))return webapp.displayMsg("\u8bc4\u8bba\u4e0d\u53ef\u4ee5\u4e3a\u7a7a\uff01");$ts.post("@api:comment",b,function(a){0==a.code&&$ts.value("#comment","")})};b.prototype.fetchMessage=function(){var a=this;webapp.modules.fetchComments("-1",this.lastId,function(b){a.lastId=b})};return b}(Bootstrap);a.chat=c})(pages||(pages={}));
(function(a){var c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}__extends(b,a);Object.defineProperty(b.prototype,"appName",{get:function(){return"share_photo"},enumerable:!0,configurable:!0});b.prototype.init=function(){var a=this;$ts("#do-upload").onclick=function(){a.doUpload()};webapp.hookImagePreviews("#inputGroupFile02","previews")};b.prototype.doUpload=function(){var a=$input("#inputGroupFile02").files[0];$ts.upload("@api:upload",a,function(a){0==a.code?$ts.post("@api:addnote",
{note:$ts.value("#note"),res:a.info},function(a){$goto("/gallery")}):console.error(a.info)})};return b}(Bootstrap);a.share_photo=c})(pages||(pages={}));
(function(a){var c=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.resourceId=$ts("@data:resource");return b}__extends(b,a);Object.defineProperty(b.prototype,"appName",{get:function(){return"view/photo"},enumerable:!0,configurable:!0});b.prototype.init=function(){var a=this;$ts("#send").onclick=function(){a.sendComment()};webapp.models.fetchComments(this.resourceId)};b.prototype.sendComment=function(){var a=$ts.value("#comment"),b={resource:this.resourceId,comment:a};if(Strings.Empty(a))return webapp.displayMsg("\u8bc4\u8bba\u4e0d\u53ef\u4ee5\u4e3a\u7a7a\uff01");
$ts.post("@api:comment",b,function(a){0==a.code&&$ts.value("#comment","")})};return b}(Bootstrap);a.view_photo=c})(pages||(pages={}));
(function(a){var c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}__extends(b,a);Object.defineProperty(b.prototype,"appName",{get:function(){return"edit/profile"},enumerable:!0,configurable:!0});b.prototype.init=function(){var a=this;webapp.hookImagePreviews("#inputGroupFile02","#avatar-preview");$ts("#save").onclick=function(){a.save()}};b.prototype.save=function(){var a=$input("#inputGroupFile02").files;!isNullOrUndefined(a)&&0<a.length&&$ts.upload("@api:uploadAvatar",a[0],
function(a){});a={whats_up:$ts.value("#whatsup"),email:$ts.value("#email"),nickname:$ts.value("#nickname")};$ts.post("@api:save",a,function(a){0==a.code?$goto("/profile"):webapp.displayMsg(a.info)})};return b}(Bootstrap);a.edit_profile=c})(pages||(pages={}));var webapp;
(function(a){a.start=function(){Router.AddAppHandler(new pages.index);Router.AddAppHandler(new pages.login);Router.AddAppHandler(new pages.share_photo);Router.AddAppHandler(new pages.view_photo);Router.AddAppHandler(new pages.edit_profile);Router.AddAppHandler(new pages.home);Router.AddAppHandler(new pages.chat);Router.RunApp()}})(webapp||(webapp={}));$ts.mode=Modes.debug;$ts(webapp.start);
(function(a){a.hookImagePreviews=function(a,d){var b=$image(d),c;$input(a).onchange=function(d){c=$input(a).files[0];b.src=URL.createObjectURL(c)}};a.displayMsg=function(a){}})(webapp||(webapp={}));
(function(a){(function(a){function c(){$ts.post("@api:addGeoLoc",{fallback:!0},function(a){console.log(a)})}function b(a){var b=a.coords.latitude,c=a.coords.longitude;$ts.post("@api:addGeoLoc",{latitude:b,longitude:c},function(a){console.log("\u7eac\u5ea6:"+b+",\u7ecf\u5ea6:"+c)})}function e(a){switch(a.code){case a.PERMISSION_DENIED:alert("\u5b9a\u4f4d\u5931\u8d25,\u7528\u6237\u62d2\u7edd\u8bf7\u6c42\u5730\u7406\u5b9a\u4f4d");break;case a.POSITION_UNAVAILABLE:alert("\u5b9a\u4f4d\u5931\u8d25,\u4f4d\u7f6e\u4fe1\u606f\u662f\u4e0d\u53ef\u7528");
break;case a.TIMEOUT:alert("\u5b9a\u4f4d\u5931\u8d25,\u8bf7\u6c42\u83b7\u53d6\u7528\u6237\u4f4d\u7f6e\u8d85\u65f6");break;default:alert("\u5b9a\u4f4d\u5931\u8d25,\u5b9a\u4f4d\u7cfb\u7edf\u5931\u6548")}}a.getLocation=function(){"http"==$ts.location.url.protocol.toLowerCase()?c():navigator.geolocation?navigator.geolocation.getCurrentPosition(b,e):alert("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u5730\u7406\u5b9a\u4f4d\u3002")}})(a.modules||(a.modules={}))})(webapp||(webapp={}));
(function(a){(function(a){a.fetchComments=function(a,b,c){void 0===b&&(b="");void 0===c&&(c=null);$ts.get("@api:load?resource="+a+"&lastid="+b,function(a){if(0==a.code){a=a.info;for(var b=$ts("#comment-list"),d=0;d<a.length;d++){var e=a[d],f=$ts("<div>",{class:"col-md-4"});f.append($ts("<img>",{src:e.avatar,class:"img-fluid rounded-circle shadow-lg",style:"width: 24px;"})).append($ts("<span>",{style:"font-size:0.9em;"}).display(e.message));b.append($ts("<div>",{class:"row"}).display(f))}!isNullOrUndefined(c)&&
0<a.length&&c(a[0].id)}})}})(a.modules||(a.modules={}))})(webapp||(webapp={}));(function(a){(function(a){function c(){"granted"==Notification.permission&&$ts.get("@api:getNewMsg",function(a){if(0==a.code){var b=a.info,c=new Notification(b.title,{body:b.content,icon:b.iconImage||"/favicon.png"});c.onclick=function(){c.close();Strings.Empty(b.link)||$goto(b.link)}}})}a.startNotification=function(){setInterval(c,1E3)}})(a.modules||(a.modules={}))})(webapp||(webapp={}));
