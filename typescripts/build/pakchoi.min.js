var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,e,b){c!=Array.prototype&&c!=Object.prototype&&(c[e]=b.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(c,e,b,a){if(e){b=$jscomp.global;c=c.split(".");for(a=0;a<c.length-1;a++){var d=c[a];d in b||(b[d]={});b=b[d]}c=c[c.length-1];a=b[c];e=e(a);e!=a&&null!=e&&$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:e})}};$jscomp.underscoreProtoCanBeSet=function(){var c={a:!0},e={};try{return e.__proto__=c,e.a}catch(b){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(c,e){c.__proto__=e;if(c.__proto__!==e)throw new TypeError(c+" is not extensible");return c}:null;$jscomp.polyfill("Object.setPrototypeOf",function(c){return c||$jscomp.setPrototypeOf},"es6","es5");$jscomp.findInternal=function(c,e,b){c instanceof String&&(c=String(c));for(var a=c.length,d=0;d<a;d++){var f=c[d];if(e.call(b,f,d,c))return{i:d,v:f}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,b){return $jscomp.findInternal(this,c,b).v}},"es6","es3");var __extends=this&&this.__extends||function(){var c=function(e,b){c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,d){a.__proto__=d}||function(a,d){for(var f in d)d.hasOwnProperty(f)&&(a[f]=d[f])};return c(e,b)};return function(e,b){function a(){this.constructor=e}c(e,b);e.prototype=null===b?Object.create(b):(a.prototype=b.prototype,new a)}}(),pages;
(function(c){var e=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"index"},enumerable:!0,configurable:!0});a.prototype.init=function(){$ts("#enter").onclick=function(){$goto("/login")}};return a}(Bootstrap);c.index=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"login"},enumerable:!0,configurable:!0});a.prototype.init=function(){var d=this;$ts.select(".people-link").onClick(function(f){return d.doLogin(f.getAttribute("people"))})};a.prototype.doLogin=function(d){var f=this;clearInterval();$ts("#open-msg").click();$ts.post("@api:login",{people:d},function(d){0==d.code?setInterval(function(){f.doCheckLogin()},
3E3):console.error(d.info)})};a.prototype.doCheckLogin=function(){$ts.get("@api:check",function(d){0==d.code?"1"==d.info&&successMsg("\u767b\u9646\u6210\u529f\uff01",function(){$goto("/home")}):errorMsg(d.info,function(){location.reload()})})};return a}(Bootstrap);c.login=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"home"},enumerable:!0,configurable:!0});a.prototype.init=function(){var d=this;$ts.select(".type0").ForEach(function(d){return d.style.display="none"});$ts("#share_geo").onclick=function(){webapp.modules.getLocation()};$ts("#granted").onclick=function(){"granted"!=Notification.permission&&Notification.requestPermission().then(function(d){"granted"==
d?webapp.modules.startNotification():webapp.displayMsg("\u6d88\u606f\u6743\u9650\u88ab\u62d2\u7edd")});console.log(Notification.permission);webapp.modules.startNotification()};"https"==$ts.location.url.protocol&&"granted"!=Notification.permission&&$("#open-msg").click();$ts("#load-more").onclick=function(){d.loadMoreNews()};d.latest_id=$ts("@latest_id");d.loadMoreNews()};a.prototype.loadMoreNews=function(){var d=this;$ts.get("@api:more?latest_id="+d.latest_id,function(a){0==a.code?d.showActivities(a.info):
webapp.displayMsg(a.info)})};a.prototype.showActivities=function(d){for(var a=$ts("#activity-list"),b,c=0;c<d.length;c++){var e=d[c];b=$ts("<div>",{class:"row"}).display('\n\t\t\t\t\t<div class="col-md-4">\n\t\t\t\t\t\t<div class="component">\n\t\t\t\t\t\t\t<div class="card mb-4">\n\t\t\t\t\t\t\t\t<div class="card-header">\n\t\t\t\t\t\t\t\t\t<img class="card-img" src=\''+e.resource+'\'>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t\t\t\t<span class="badge badge-success mb-2">'+
e.tag+'</span>\n\t\t\t\t\t\t\t\t\t<h4 class="card-title">'+e.create_time+'</h4>\n\t\t\t\t\t\t\t\t\t<p class="card-text">'+e.content+"</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class='card-footer type"+e.type+"'>\n\t\t\t\t\t\t\t\t\t<a href='"+e.link+'\' class="btn btn-primary">\u67e5\u770b</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>');a.append(b);this.latest_id=e.id}};return a}(Bootstrap);c.home=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"chat"},enumerable:!0,configurable:!0});a.prototype.init=function(){var d=this;setInterval(function(){d.fetchMessage()},3E3);$ts("#send").onclick=function(){d.sendComment()};webapp.modules.fetchComments("-1",-1,function(a){d.lastId=a})};a.prototype.sendComment=function(){var d=$ts.value("#comment"),a={resource:-1,comment:d};if(Strings.Empty(d))return webapp.displayMsg("\u8bc4\u8bba\u4e0d\u53ef\u4ee5\u4e3a\u7a7a\uff01");
$ts.post("@api:comment",a,function(d){0==d.code&&$ts.value("#comment","")})};a.prototype.fetchMessage=function(){var d=this;$ts.get("@api:update?last_id="+d.lastId,function(a){if(0==a.code){a=a.info;var f=$ts("#comment-list");0<a.length&&(d.lastId=a[a.length-1].id);webapp.modules.appendComments(f,a)}})};return a}(Bootstrap);c.chat=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"gallery"},enumerable:!0,configurable:!0});a.prototype.init=function(){$ts.get("@api:gallery",function(d){0==d.code?a.showGallery(d.info):webapp.displayMsg(d.info)})};a.showGallery=function(d){for(var a=$ts("#photos"),b,c=0;c<d.length;c++)b=d[c],b=$ts("<div>",{class:"row"}).display('\n<div class="col-12 col-md-4">\n<a href="/view/photo/'+
b.id+'">\n    <div class="square" style="background-image:url(\''+b.url+"?type=preview');\">\n    </div>\n</a>\n                            </div>"),a.append(b)};return a}(Bootstrap);c.gallery=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"goals"},enumerable:!0,configurable:!0});a.prototype.init=function(){var d=this;$ts("#").onclick=function(){d.create_goal()};d.show_goals()};a.prototype.create_goal=function(){};a.prototype.show_goals=function(){};return a}(Bootstrap);c.goals=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){var d=null!==b&&b.apply(this,arguments)||this;d.loadVisitsDone=!1;d.loadLoginsDone=!1;return d}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"profile"},enumerable:!0,configurable:!0});a.prototype.init=function(){var d=this,a=loading("\u6b63\u5728\u52a0\u8f7d\u6570\u636e...");$ts.get("@api:visits",function(f){0==f.code?(d.renderVisitList(f.info),d.loadVisitsDone=!0,d.loadVisitsDone&&d.loadLoginsDone&&layer.close(a)):(layer.closeAll(),
errorMsg(f.info))});$ts.get("@api:logins",function(f){0==f.code?(d.renderLoginList(f.info),d.loadLoginsDone=!0,d.loadVisitsDone&&d.loadLoginsDone&&layer.close(a)):(layer.closeAll(),errorMsg(f.info))})};a.prototype.renderLoginList=function(d){for(var a=$ts("#login-list"),b,c=0;c<d.length;c++)b=d[c],b=$ts("<span>",{style:"font-size:0.8em;color:lightgray"}).display(b.create_time).append($ts("<span>",{}).display(b.content)),a.append($ts("<li>").display(b))};a.prototype.renderVisitList=function(d){for(var a=
$ts("#visit-list"),b,c=0;c<d.length;c++)b=d[c],b=$ts("<span>",{style:"font-size:0.8em;color:lightgray"}).display(b.time).append($ts("<span>",{}).display($ts("<a>",{href:b.page_url}).display(b.page_url))),a.append($ts("<li>").display(b))};return a}(Bootstrap);c.profile=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"memorials"},enumerable:!0,configurable:!0});a.prototype.init=function(){var d=this;$ts.get("@data:memorials",function(a){0==a.code?d.show_memorials(a.info):webapp.displayMsg(a.info)})};a.prototype.show_memorials=function(d){for(var a=$ts("#timeline"),b=0;b<d.length;b++){var c=d[b];c=$ts("<li>").display('<div class="timeline-time">\n                                <span class="date">'+
c.date+'</span>                               \n                            </div>\n                    \n                            <div class="timeline-body">\n                                <div class="timeline-header">\n                                    <span class="userimage"><img\n                                            src="'+c.add_user+'" alt=""></span>\n                                    <span class="username"><a href="javascript:void(0);">'+c.name+'</a> <small></small></span>                                  \n                                </div>\n                                <div class="timeline-content">\n                                    <p>\n                                        <a href="/view/memorial/'+
c.id+'">'+c.description+"</a>\n                                    </p>\n                                </div>                       \n                            </div>");a.append(c)}};return a}(Bootstrap);c.memorials=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"share_photo"},enumerable:!0,configurable:!0});a.prototype.init=function(){var d=this;$ts("#do-upload").onclick=function(){d.doUpload()};webapp.hookImagePreviews("#inputGroupFile02","#previews")};a.prototype.doUpload=function(){var d=$input("#inputGroupFile02").files[0],a=$from($ts.location.url.query).ToDictionary(function(a){return a.name},
function(a){return a.value}).Object,b=loading("\u6b63\u5728\u4e0a\u4f20\u76f8\u7247\uff0c\u8bf7\u4e0d\u8981\u5237\u65b0\u9875\u9762...");$ts.upload("@api:upload",d,function(d){0==d.code?(isNullOrUndefined(a)&&(a={}),a.note=$ts.value("#note"),a.res=d.info,$ts.post("@api:addnote",a,function(a){layer.close(b);successMsg("\u4e0a\u4f20\u6210\u529f\uff01",function(){$goto("/gallery")})})):errorMsg(d.info)})};return a}(Bootstrap);c.share_photo=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"share_video"},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"upload_url",{get:function(){return $ts("@api:upload")},enumerable:!0,configurable:!0});a.prototype.init=function(){var a=this;$("#fileupload").fileupload({stop:function(d,b){a.stop(d,b)},change:function(d,b){a.change(d,b)},add:function(d,b){a.add(d,
b,$(this))},getFilesFromResponse:function(d){a.getFilesFromResponse(d)}})};a.prototype.stop=function(a,b){TypeScript.logging.log("Stop!",TypeScript.ConsoleColors.Red)};a.prototype.change=function(a,b){TypeScript.logging.log("Changed!",TypeScript.ConsoleColors.Green)};a.prototype.getFilesFromResponse=function(a){var d=a.result.info;0==a.result.code?layer.msg(d,{icon:1},function(){parent.location.reload()}):layer.msg(d,{icon:5},function(){});if(a.result&&$.isArray(a.files))return a.files};a.prototype.add=
function(a,b,c){var d=/^file\/(mp4)$/i,e=!1;b.files.map(function(a){a.type.length&&!d.test(a.type)&&(e=!0)});if(e)return layer.msg("\u8bf7\u4e0a\u4f20MP4\u89c6\u9891\u6587\u4ef6\uff01",{icon:0}),!1;TypeScript.logging.log(this.upload_url,TypeScript.ConsoleColors.Blue);c.fileupload("option","url",this.upload_url);var f=c.data("blueimp-fileupload")||c.data("fileupload"),g=f.options;b.context=f._renderUpload(b.files).data("data",b).addClass("processing");g.filesContainer[g.prependFiles?"prepend":"append"](b.context);
f._forceReflow(b.context);f._transition(b.context);b.process(function(){return c.fileupload("process",b)}).always(function(){b.context.each(function(a){$(this).find(".size").text(f._formatFileSize(b.files[a].size))}).removeClass("processing");f._renderPreviews(b)}).done(function(){b.context.find(".start").prop("disabled",!1);!1!==f._trigger("added",a,b)&&(g.autoUpload||b.autoUpload)&&!1!==b.autoUpload&&b.submit()})};return a}(Bootstrap);c.share_video=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"share/memorial"},enumerable:!0,configurable:!0});a.prototype.init=function(){$ts("#do-add").onclick=function(){var a=$ts.value("#event"),b=$ts.value("#date");$ts.post("@api:add",{event:a,date:b},function(a){0==a.code?$goto("/memorials"):webapp.displayMsg(a.info)})}};return a}(Bootstrap);c.share_memorial=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.resourceId=$ts("@data:resource");return a}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"view/photo"},enumerable:!0,configurable:!0});a.prototype.init=function(){var a=this;$ts("#send").onclick=function(){a.sendComment()};webapp.modules.fetchComments(this.resourceId,0)};a.prototype.sendComment=function(){var a=$ts.value("#comment"),b={resource:this.resourceId,comment:a,type:0};
if(Strings.Empty(a))return webapp.displayMsg("\u8bc4\u8bba\u4e0d\u53ef\u4ee5\u4e3a\u7a7a\uff01");$ts.post("@api:comment",b,function(a){0==a.code&&$ts.value("#comment","")})};return a}(Bootstrap);c.view_photo=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.activityId=$ts("@data:activityId");return a}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"view/location"},enumerable:!0,configurable:!0});a.prototype.init=function(){var a=this;$ts.get("@api:getLocation?id="+this.activityId,function(d){0==d.code&&(d=d.info,d.fallback&&a.renderBaidDuMapLocation(d))})};a.prototype.renderBaidDuMapLocation=function(a){var d=a.address+": ["+a.content.point.x+
", "+a.content.point.y+"]";console.log(a);$ts("#info").clear().display(d);$link("#viewMap").href="/baiduMap?x="+a.content.point.x+"&y="+a.content.point.y};return a}(Bootstrap);c.view_location=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.evtId=$ts("@data:id");return a}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"view/memorial"},enumerable:!0,configurable:!0});a.prototype.init=function(){var a=this;$ts.get("@api:load_event?id="+$ts("@data:id"),function(b){0==b.code?a.showDetails(b.info):webapp.displayMsg(b.info)});$ts("#send").onclick=function(){a.sendComment()};webapp.modules.fetchComments(this.evtId,1);
$ts.get("@api:gallery?memorial="+this.evtId,function(a){0==a.code?c.gallery.showGallery(a.info):webapp.displayMsg(a.info)})};a.prototype.sendComment=function(){var a=$ts.value("#comment"),b={resource:this.evtId,comment:a,type:1};if(Strings.Empty(a))return webapp.displayMsg("\u8bc4\u8bba\u4e0d\u53ef\u4ee5\u4e3a\u7a7a\uff01");$ts.post("@api:comment",b,function(a){0==a.code&&$ts.value("#comment","")})};a.prototype.showDetails=function(a){$ts("#title").display(a.name+"\u5728"+a.date+"\u6dfb\u52a0\u4e86\u4e00\u4e2a\u7eaa\u5ff5\u65e5");
$ts("#content").display(a.description);$ts("#days").display("\u5df2\u7ecf\u8fc7\u53bb"+a.days.days+"\u5929\u4e86")};return a}(Bootstrap);c.view_memorial=e})(pages||(pages={}));
(function(c){var e=function(b){function a(){return null!==b&&b.apply(this,arguments)||this}__extends(a,b);Object.defineProperty(a.prototype,"appName",{get:function(){return"edit/profile"},enumerable:!0,configurable:!0});a.prototype.init=function(){var a=this;webapp.hookImagePreviews("#inputGroupFile02","#avatar-preview");$ts("#save").onclick=function(){a.save()}};a.prototype.save=function(){var a=$input("#inputGroupFile02").files;!isNullOrUndefined(a)&&0<a.length&&$ts.upload("@api:uploadAvatar",a[0],
function(a){});a={whats_up:$ts.value("#whatsup"),email:$ts.value("#email"),nickname:$ts.value("#nickname")};$ts.post("@api:save",a,function(a){0==a.code?$goto("/profile"):webapp.displayMsg(a.info)})};return a}(Bootstrap);c.edit_profile=e})(pages||(pages={}));var webapp;
(function(c){c.start=function(){Router.AddAppHandler(new pages.index);Router.AddAppHandler(new pages.login);Router.AddAppHandler(new pages.share_photo);Router.AddAppHandler(new pages.share_video);Router.AddAppHandler(new pages.share_memorial);Router.AddAppHandler(new pages.view_photo);Router.AddAppHandler(new pages.view_location);Router.AddAppHandler(new pages.view_memorial);Router.AddAppHandler(new pages.edit_profile);Router.AddAppHandler(new pages.home);Router.AddAppHandler(new pages.chat);Router.AddAppHandler(new pages.gallery);
Router.AddAppHandler(new pages.memorials);Router.AddAppHandler(new pages.profile);Router.AddAppHandler(new pages.goals);"granted"==Notification.permission?c.modules.startNotification():console.log(Notification.permission);Router.RunApp()}})(webapp||(webapp={}));$ts.mode=Modes.debug;$ts(webapp.start);(function(c){c.hookImagePreviews=function(c,b){var a=$image(b),d;$input(c).onchange=function(b){d=$input(c).files[0];a.src=URL.createObjectURL(d)}};c.displayMsg=function(c){}})(webapp||(webapp={}));
(function(c){(function(c){function b(){$ts.post("@api:addGeoLoc",{fallback:!0},function(a){console.log(a)})}function a(a){var b=a.coords.latitude,d=a.coords.longitude;$ts.post("@api:addGeoLoc",{latitude:b,longitude:d},function(a){console.log("\u7eac\u5ea6:"+b+",\u7ecf\u5ea6:"+d)})}function d(a){switch(a.code){case a.PERMISSION_DENIED:alert("\u5b9a\u4f4d\u5931\u8d25,\u7528\u6237\u62d2\u7edd\u8bf7\u6c42\u5730\u7406\u5b9a\u4f4d");break;case a.POSITION_UNAVAILABLE:alert("\u5b9a\u4f4d\u5931\u8d25,\u4f4d\u7f6e\u4fe1\u606f\u662f\u4e0d\u53ef\u7528");
break;case a.TIMEOUT:alert("\u5b9a\u4f4d\u5931\u8d25,\u8bf7\u6c42\u83b7\u53d6\u7528\u6237\u4f4d\u7f6e\u8d85\u65f6");break;default:alert("\u5b9a\u4f4d\u5931\u8d25,\u5b9a\u4f4d\u7cfb\u7edf\u5931\u6548")}}c.getLocation=function(){"http"==$ts.location.url.protocol.toLowerCase()?b():navigator.geolocation?navigator.geolocation.getCurrentPosition(a,d):alert("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u5730\u7406\u5b9a\u4f4d\u3002")}})(c.modules||(c.modules={}))})(webapp||(webapp={}));
(function(c){(function(c){function b(a,b){for(var d=0;d<b.length;d++){var c=b[d],e=$ts("<div>",{class:"col-md-4"});e.append($ts("<img>",{src:c.avatar,class:"img-fluid rounded-circle shadow-lg",style:"width: 24px;"}));var h=$ts("<span>",{style:"font-size:0.7em; color: lightgray"}).display(c.message_time+"<br />"),k=$ts("<span>",{style:"font-size:0.9em;"}).display(c.message);isNullOrUndefined(c.target)?e.append(h).append(k):(c=$ts("<span>").display(c.target.title+"<br />"),e.append(h).append(c).append(k));
a.append($ts("<div>",{class:"row"}).display(e))}}c.fetchComments=function(a,d,c){void 0===c&&(c=null);$ts.get("@api:load?resource="+a+"&type="+d,function(a){if(0==a.code){a=a.info;var d=$ts("#comment-list");b(d,a);!isNullOrUndefined(c)&&0<a.length&&c(a[a.length-1].id)}})};c.appendComments=b})(c.modules||(c.modules={}))})(webapp||(webapp={}));
(function(c){(function(c){function b(){"granted"==Notification.permission&&$ts.get("@api:getNewMsg",function(a){if(0==a.code){var b=a.info,c=new Notification(b.title,{body:b.content,icon:b.iconImage||"/favicon.png"});c.onclick=function(){c.close();Strings.Empty(b.link)||$goto(b.link)}}})}c.startNotification=function(){var a=Strings.Trim($ts.location.path,"/");""!=a&&"login"!=a&&"chat"!=a&&setInterval(b,5E3)}})(c.modules||(c.modules={}))})(webapp||(webapp={}));
